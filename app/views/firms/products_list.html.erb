<%= render 'shared/basic_navigation', navigation: {
    back: firm_path(@firm)
} %>
<%= form_tag products_list_firm_path, { method: :get, params: params, class: 'form-horizontal' } do %>
    <div class="form-group">
      <div class="col-1">
        <%= label_tag :valid_from, t('view.firms.buys.valid_from'), class: 'from-label js-focus-this' %>
      </div>
      <div class="col-2 mar-right-2">
        <%= text_field_tag :valid_from, @valid_from, class: 'form-input', type: :date %>
      </div>
      <div class="col-4">
        <%= button_tag t('view.firms.buys.update_list'), class: 'btn' %>
      </div>

      <%= hidden_field_tag :trade_type, params[:trade_type] %>
    </div>

<% end %>

<div class="products-list">
  <% if params[:trade_type] === 'buys' %>
    <section class="products-list__banner">
      <div class="columns">
        <div class="column col-4 margin-auto">
          <%= image_tag image_path('logo_full.jpg'), { class: 'image-fill' } %>
        </div>
      </div>
    </section>

    <%= form_tag products_list_firm_path, { method: :get, target: '_blank' } do %>
      <div class="text-center">
        <%= button_tag t('view.firms.buys.generate_pdf'), class: 'btn' %>
        <%= button_tag t('view.firms.buys.restore_product'), class: 'btn btn-sm hidden js-trades-list__show-trade' %>
      </div>

      <section class="products-list__header pad-top-3 mar-top-1">
        <div class="products-list__header__date"><%= text_field_tag :header_date, @information[:header_date] %></div>
        <div class="products-list__header__firm pad-top-3"><%= text_field_tag :header_firm, @information[:header_firm] %></div>
        <div class="products-list__header__contact pad-top-1"><%= text_field_tag :header_contact, @information[:header_contact] %></div>
        <div class="products-list__header__title pad-top-6"><%= text_field_tag :header_title, @information[:header_title] %></div>
      </section>

      <%= hidden_field_tag :trade_type, params[:trade_type] %>
      <%= hidden_field_tag :valid_from, params[:valid_from] %>
      <%= hidden_field_tag :hidden_trades, params[:hidden_trades], class: 'js-trades-list__array' %>
      <%= hidden_field_tag :format, :pdf %>
    <% end %>
  <% end %>

  <section class="products-list__list pad-top-3">
    <table class="table table-hover">
      <tbody>
      <% @trades.each do |trade| %>
          <tr data-trade-id="<%= trade.id %>">
            <td><%= trade.product.name %></td>
            <td class="products-list__list__price">
              <%= t('view.firms.buys.products_list_price',
                    price: trade.price_valid_from(@valid_from).try(:price),
                    unit: trade.product.unit)
              %>
            </td>
            <td>
              <%= button_tag t('label.hide'), class: 'btn btn-sm js-trades-list__hide-trade' %>
            </td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </section>
</div>

<% content_for :ready_js do %>
  Utils.focusField(document);

  TradesList.init();
<% end %>
